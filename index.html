<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>fisuMapBaires</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <h2 id="modeTitle">fisuMapBaiiiires - Modo Visor</h2>
  <button id="addPointBtn">Agregar Punto</button>
  <div id="mapContainer"></div>
  <div id="pointForm">
    <label for="layerSelect">Categoría:</label>
    <select id="layerSelect">
      <option value="fisuras">Fisuras</option>
      <option value="limpieza">Limpieza</option>
      <option value="trapitos">Trapitos</option>
      <option value="narcomenudeo">Narcomenudeo</option>
      <option value="casas-tomadas">Casas Tomadas</option>
      <option value="comercios-fisuras">Comercios Fisuras</option>
      <option value="via-publica">Vía Pública</option>
    </select>
    <label for="addressInput">Dirección:</label>
    <input type="text" id="addressInput" placeholder="Ingresá una dirección">
    <button onclick="geocodeAddress()">Buscar</button>
    <button onclick="getCurrentLocation()">Ubicación Actual</button>
    <label for="userInput">Usuario:</label>
    <input type="text" id="userInput" placeholder="Anónimo">
    <label for="titleInput">Título:</label>
    <input type="text" id="titleInput">
    <label for="descriptionInput">Descripción:</label>
    <textarea id="descriptionInput"></textarea>
    <label for="photoInput">Fotos (máx. 5, JPG/PNG):</label>
    <input type="file" id="photoInput" accept="image/jpeg,image/png" multiple>

    <!-- Sección de horarios (inicialmente oculta) -->
    <div id="horariosSection" style="display: none;">
      <h4>Horarios (solo Comercios Fisuras)</h4>
      <label for="sameSchedule">
        <input type="checkbox" id="sameSchedule" onchange="toggleScheduleFields()"> Todos los días mismo horario
      </label>
      <div id="sameScheduleFields" style="display: none;">
        <div class="schedule-row">
          <input type="time" id="sameApertura">
          <input type="time" id="sameCierre">
        </div>
      </div>
      <div id="differentScheduleFields" style="display: none;">
        <div class="schedule-row">
          <span>Lun-Vie:</span>
          <input type="time" id="lvApertura">
          <input type="time" id="lvCierre">
        </div>
        <div class="schedule-row">
          <span>Sábado:</span>
          <input type="time" id="sabApertura">
          <input type="time" id="sabCierre">
          <label for="sabCerrado" class="cerrado-label">
            <input type="checkbox" id="sabCerrado" onchange="toggleSabadoFields()">
            <span class="cerrado-text">Cerrado</span>
          </label>
        </div>
        <div class="schedule-row">
          <span>Domingo:</span>
          <input type="time" id="domApertura">
          <input type="time" id="domCierre">
          <label for="domCerrado" class="cerrado-label">
            <input type="checkbox" id="domCerrado" onchange="toggleDomingoFields()">
            <span class="cerrado-text">Cerrado</span>
          </label>
        </div>
      </div>
    </div>

    <button id="submitBtn">Enviar Punto</button>
  </div>
  <div id="pointDetails">
    <div id="photoContainer"></div>
  </div>
  <div id="imageOverlay" onclick="hideOverlay()"></div>
  <div id="layerControls">
    <h3>Capas</h3>
    <label style="background-color: red" for="fisurasCheck"><input type="checkbox" id="fisurasCheck" checked
        onchange="updateLayers()"> Fisuras <span id="fisurasCount">(0)</span></label>
    <label style="background-color: green" for="limpiezaCheck"><input type="checkbox" id="limpiezaCheck" checked
        onchange="updateLayers()"> Limpieza <span id="limpiezaCount">(0)</span></label>
    <label style="background-color: yellow" for="trapitosCheck"><input type="checkbox" id="trapitosCheck" checked
        onchange="updateLayers()"> Trapitos <span id="trapitosCount">(0)</span></label>
    <label style="background-color: purple" for="narcomenudeoCheck"><input type="checkbox" id="narcomenudeoCheck"
        checked onchange="updateLayers()"> Narcomenudeo <span id="narcomenudeoCount">(0)</span></label>
    <label style="background-color: orange" for="casas-tomadasCheck"><input type="checkbox" id="casas-tomadasCheck"
        checked onchange="updateLayers()"> Casas Tomadas <span id="casas-tomadasCount">(0)</span></label>
    <label style="background-color: brown" for="comercios-fisurasCheck"><input type="checkbox"
        id="comercios-fisurasCheck" checked onchange="updateLayers()"> Comercios Fisuras <span
        id="comercios-fisurasCount">(0)</span></label>
    <label style="background-color: gray" for="via-publicaCheck"><input type="checkbox" id="via-publicaCheck" checked
        onchange="updateLayers()"> Vía Pública <span id="via-publicaCount">(0)</span></label>
    <label style="background-color: blue" for="comisariasCheck"><input type="checkbox" id="comisariasCheck" checked
        onchange="updateLayers()"> Comisarías <span id="comisariasCount">(0)</span></label>
    <div class="button-container">
      <button onclick="selectAllLayers()">Ver todo</button>
      <button onclick="deselectAllLayers()">Ninguna</button>
    </div>
  </div>
  <div id="savingMessage">Guardando punto, por favor esperá...</div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>


  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js';
    import { getFirestore, collection, getDocs, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/10.13.2/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: process.env.FIREBASE_API_KEY,
      authDomain: process.env.FIREBASE_AUTH_DOMAIN,
      projectId: process.env.FIREBASE_PROJECT_ID,
      storageBucket: process.env.FIREBASE_STORAGE_BUCKET,
      messagingSenderId: process.env.FIREBASE_MESSAGING_SENDER_ID,
      appId: process.env.FIREBASE_APP_ID
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    window.db = db;
    window.collection = collection;
    window.getDocs = getDocs;
    window.addDoc = addDoc;
    window.serverTimestamp = serverTimestamp;
  </script>

  <script type="module" src="script.js"></script>

</body>

</html>